03.5-Earth mover's distance
https://www.youtube.com/watch?v=pl3mIDXHZBE
 en el vídeo pasado vimos del espacio hablamos del espacio así y que nos permite calcular similitud entre colores y que para calcular histogramas nosotros hacer una división regular del espacio relieve y luego en la función de distancia calcular la similitud usando el espacio 100 pero el problema es que siempre estamos haciendo una misma partición de los colores para todo el datacenter el cubo rgb lo vamos a dividir previamente y puede que en el set casi todas las imágenes tienen unas diferencias las imágenes se representen por muchos tonos de verde y en ese caso tendríamos que hacer una división muy fina de todo el espacio para poder representar bien los colores para ver diferencia en la imagen una idea que es mucho más eficiente el espacio y en representar mejor a las imágenes consiste en hacer una división por imagen exclusiva para cada imagen se llama el inning adaptativo división de éste de del listo grama por imagen la idea es que en una interna o una imagen cada punto cada pixel es un relieve podemos ver la misma imagen si llevamos al espacio rgb cada pixel es un punto importante una imagen es una nube de puntos bueno esto no es reversible porque aquí estamos perdiendo en la ubicación espacial de la imagen pero podemos ver que todos los colores de la imagen están aquí en cierta nube y si queremos calcular histograma podemos tratar de en vez de hacer una división previa de este espacio de colores qué tal si hacemos una división exclusiva para esta nube de puntos para representar de la mejor forma esta nueva fuente cómo hacemos eso mediante un algoritmo que analice las distribuciones de los colores de esta nube de puntos y alguna división de haddock hay una forma con que se cuentan de esto de hacer un pastel definido por ejemplo de cinco bienes y con gaming se hace corremos un algoritmo de división del espacio y van a aparecer androides que van a estar bueno que se van a aparecer en las mayores densidades de emisiones y entonces nos va a decir en esta imagen hay mucho verde verde y verde dosis que hay este loto centro lido y un poco de hacer un poco de celeste y un poco de brillo y estos son estos son las mayores densidades y luego calculamos cada imagen cada píxel de la imagen creo que verá cuál de estos cinco mil son para sumarle más entonces si él quiere ir al cielo le va a sumar más uno al ser este que su color más cercano y cómo podemos saber cuál el color más cercano mediante distancias en el espacio sí puede ser el paso regenere pero ya mismo que no es tan incorrecto de empezar con los verdes e eso no quiere que la gente esté aquí un algoritmo clusterin vamos a determinar en acción traders por imagen y esos centro inglés que vamos a llamar ese 1 a sn son los colores más representativos de la imagen y luego como calculamos el el histograma es de un programa de cuántos se repiten estos colores representativos dentro de la imagen una espera que está representando la nube de colores dentro de la imagen de la forma lo más con menor pérdida posible y entonces esto lo que decía tomamos luego tomamos una que ya tenemos tenemos color uno hasta color tiene tomamos el color energía bien y tenemos que saber a cuál le corresponde y ese bien le sumamos maxwell pero hay veces en que en especial la equipara esta nube de puntos donde aquí tenemos el centro desde un centro de dos etc el color va a estar muy cerca del borde y este se redondea su más cercano pero faltaba cerca del otro y el hecho se llama una asignación suave de esta misma idea lo hablamos con héctor amarís es donde vamos a sumar ya no más una acción deberíamos ser 505 ok pero podemos hacer en realidad más genérico y hacer una asignación difusa a todos los bienes dependiendo de su distancia y lo comparamos con cada uno de los n colores y vamos a calcular una distancia y vamos a tener distancia 1 a distancia n y ese va a ser el voto de ponderación pero aquí tenemos que dar las distancias y la distancia más cercana en la que llama más votación y la estación más lejana en la quién lleva menos votación aquí lo común es bueno hacer una escala lineal o hacer una exponencial una exponencial con un exponente negativo son una forma y normalizaron porque el voto es esencialmente lo que estamos calculando como zonas dentro de cada de cada centro de la zona de influencia y lo pondríamos por eso apuesta pues a graus jana que está centrada en la altura ya eso sería un sofá sangre y luego queremos normalizar la suma de los historiadores ya calculados donde vamos a tener el peso filme tres programas es un peso de w 1 w en el peso de cada uno de ellos tiene androides y esto espera que se asuma una cosa que nos dé una especie de distribución de probabilidad ok hasta aquí hemos representado muy bien los colores de la imagen ahora el problema es como lo compramos como calculamos la distancia entre dos historia mañana ahora el histograma de nuez no son n valores sino que además son en valores con el director es la que nos dice que representa en cada evento nos dice que representa cada bien a este tipo de descriptor le llamaremos signatura [Música] y el signature se refiere a que es una historia pero generalizada donde es el histograma son n pesos pero además son electores que nos dice de alguna forma qué significa cada una de las eliminaciones entonces es una media hora mujer desde 1 de enero dice que significa gravamen y en ese caso el histograma de color es el color el color que representa es el y luego lo doble de eso los pesos y nos dice cuál es la distribución de importancia de esos escolares de otros seguros comparamos d una forma adecuada consiste en modelar esto con una distancia de cómo se convierte una distribución en la otra es decir tengo uno de l'ebre 1a w n de esta imagen su programa esto es una escena tengo n colores desde uno hace en cada uno de los colores tiene pesos y tengo otra imagen una imagen 2 no donde aquí hay una casa y esto tiene 1 w 1 a doblar en el corazón y tiene otros colores cómo podemos saber cuál es la distancia entre ellas después de la distancia entre estos dos extremos no puede realizar su cría de hecho en principio estos no tienen ni siquiera por qué ser del mismo largo pueden ser estuve de las 325 es cómo calculamos la distancia la termo bears distance nos permite calcular eso y de gráficamente si vamos al espacio pero gm si vamos al espacio garage a ver aquí tenemos el perro es el géiser lr el genial bien los colores de una imagen la imagen roja digamos se pueden ver como cinturones de uno y aquí va a tener un peso un centro es de dos digamos que aquí hay un 0-5 de todo de importancia una co2 yo tengo 0 2 y vamos a tener un color 3 va a estar acá y va a valer los bienes 3 y la imagen azul va a tener cierto el color uno puede estar acá con cierto peso y el color que está acá y hasta camisetas concierto más la distancia entre ellos consiste en cómo a partir del rojo puedo mover las distribuciones vea que los dos tienen que sumar uno y nos va a decir como él como 1 c como los rojos los tengo que mover y vean que en cada movimiento hay un peso de un costo de mover una unidad desde un botón que se llama el por una matriz de costos entonces mover algo de elvin uno de uno de un programa al bien donde los texto grama tienen un costo asociado a su distancia entonces vamos a tener que se llama la matriz de costos que va a tomar los s 1 a la escena de una imagen de la c1 escena de los de imagen y aquí nos va a decir la distancia en realidad que es el costo que hay que pagar para mover una unidad desde un bien hasta el otro de los colores 3 con la distancia en el espacio sí y entonces hay que hay muchas opciones de esencialmente tienen podemos mover como tenemos distribuciones en ciertas posiciones queremos moverlos a las otras posiciones hay mucha posibilidad de con un modelo pero cada movimiento tiene un costo distinto entonces lo que vamos a hacer es que vamos a llenar una matriz quizá la matriz de flujos la respuesta a esto es que vamos a poner tenemos 0 5 se los doy se lo tienes de 1 y en el otro 04 04 tenemos que decir cómo se van a mover desde uno hasta el otro bien parando cierto que es todo por la mantiene de cuentas el problema esto es un problema de optimización de que lograr encontrar que ponemos acá para lograr pagar el costo de estos iremos el problema transporte porque esto viene estudiar una optimización en los cursos de ingeniería ayuda encuestas de optimización que entienden y de orán obligatorio cuando ingería si era obligatorio y por ejemplo tiene que ver con él supongamos que tenemos en chile y tenemos unas bodegas donde tenemos 100 cajas en talca que nos dicen si encaja en antofagasta los 200 cajas en talca y 40 cajas en puerto com digamos estilo y nos piden tener una utilización porque nos pidieron a quien tenemos que mover esas cajas y que tenemos que llenar aquí hay un dije de potencia 50 cajas entre 150 cajas y que tuvo que llenar 40 cajas acá arriba y todo el resto tiene que estar acá abajo aquí digamos en la serena y el resto deben estar aquí en temuco cuál es la mejor forma de estas doscientas cuántas tienen que ir para acá o para allá la propuesta transportar digamos en cuanto nos cobren también cuánto nos cobra por mover las cajas de logros y él y tenemos que empezar a utilizar cómo mover las cajas dura de los centralidades mismos legales el mismo problema que estamos diciendo que no encuentra optimizaciones no se ve el algoritmo para responder esto siempre que el algoritmo que esté un saca bien en la optimización que se usa para resolver un problema de transporte y el problema de transporte se define como una cantidad que hay que mover dos cantidades por ejemplo en el caso aquí en este programa tenemos un programa de 3 24 bits donde decimos el origen y dice ay 023 de verde 063 de excelentes 014 de amarillo y el y queremos llegar a estas cuatro distribuciones del pelo a otra portería tenemos cajas en estas ubicaciones del país y no están pidiendo cajas tenemos que llevar como dos despachos a estas cuatro ubicaciones con esta cantidad de cajas cuál es la mejor forma de mover las cajas donde tenemos que pagar para mover de cada el costo a mover una caja he estado por esto que es la matriz de pastos y esto sería la distancia en el en colores no entonces para mover una caja de enviar de naranjo hay que embargar 051 de este vernes teatro verde verde muy parecido así que es nuestro 6 de verde naranjo ha ido un poco menos y él y él mismo el blue mismo para este tipo de parte esto de aquí es el importe cuando nos dicen este es un programa de la imagen una imagen y estructura de imagen 2 nosotros necesitamos algo que seamos una gran distancia para comparar los s uno de los centros los colores en algunas formas tenemos que poder decir que tanto si aparecen o se diferencian los miles de uno de un programa con los bits de los historia y como realmente esto es sería el titán suscribiera de espacios y la luz aunque este libro y lo que necesitamos es crear una matriz de flujos el algoritmo aquí esté limpio para los mínimos simples y dice tenemos 0 23 063 0 14 1 2 y 3 y tenemos que llegar a estas distribuciones destino ya que tienen que sumar 1 ambos sea cierto no podemos inventar cajas de water cajas y la pregunta es qué ponemos acá este día y el algoritmo en desarrollar aquí hizo como llegamos hasta aquí tenemos que poner 12 números que es para cada uno de los tres bits de origen hay que decir cuántos enviamos a cada uno de los cuatro vientos del esquí y cualquier cosa mientras se cumpla la restricción de que todas las cajas salgan y todas las cajas lleguen es decir que la suma por por ejemplo 0 23 si quiero comprar nuestro 22 aquí y este 0 1 se lo voy a poner a este pero bueno que una puerta aquí dije todas las cajas del virus no se movieron a estos destinos del que aquí tercero 22 puntos pobres más porque no quieren más este 0 63 podría decir que como lo voy a mover los voy a poner a 042 aquí y aquí me faltan 0 21 así que voy a ver 0 21 y aisha que todas las cajas y para ella y el 0 14 como hace que suma 1 esto ya está debe decidir qué aceptó que iba a tener que ir el 0.01 0,11 aquí y aquí aparecen sólo tres pero a 0 0 3 se ve como cualquier asignación independiente sea óptima o no debe de cumplir una restricción que es que la suma por fila la suma de cada una de las filas de los números que tiene que dar en lo que corresponde al origen la suma por filas tiene que ver con el correspondiente cierto entorno lo completamos y la suma por columnas tiene que dar lo que lo que dice en el tiempo con estas restricciones aún hay una gran cantidad de opciones de ahí cuál de todas ellas es supongamos que vamos a áreas y va a ser un algoritmo medio rango de el costo total consiste en multiplicar el lo que yo dije que hay que mover lo que yo dije que hay que mover hay que multiplicarlo por el costo de mover de aquí el costo de la sumatoria de una sumatoria de los sesos y jota por los ejes sus hijos es decir aquí para esto número equipo se va hacer el 0,22 x 0 51 más el 0.01 x el 0,6 más del 0 21 x 0 decimal más 0.42 por 0-6 0.3 x 0 51 y 0,3 x este el costo total con total para este plan para este plan de movimientos la idea es que probar distintos planes de movimientos para lograr el plan que logra dar el costo menor total cómo podemos hacer eso este es sólo abrimos impresa y lo que dice es un algoritmo grind y sin llegar a la implementación de que esencialmente mirando aquí nosotros sabemos que éste asume para fe y como aquí tengo que llenarse los 12 como éste está súper barato ni para llenar así que estos 0 12 como aquí tenemos que tomar los de acá y esperemos cómo maxwell es un algoritmo que toma una decisión óptima de inmediato una decisión apurada en el caso de cero y luego el otro y ojala que hayamos tomado una buena decisión el siguiente equipo es bueno en el siguiente donde quieres llegar aquí con 043 así que es el bueno pero aquí ya estamos para hacerlo el siguiente que estaba barato esto 041 esto es intuitivo no nos interesa que sepas cuál es el algoritmo pero que en realidad los mínimos de aquí toman están muy baratos y que 14 20 14 y que aquí el 0 42 está barato y estemos que irán es lo que nos falta él por ejemplo entonces aquí en este 0 42 estamos listos con este estamos listos con éste y el 0 24 con cuatro manos 0 24 podríamos tomar los de aquí y aquí nos quiere nos quieren solamente que ya ocupamos 012 de tías y que nos quieran 011 disponibles y ojalá que sea una buena decisión y aquí el 24 nos falta nos falta 0 13 y en los 13 menos de aquí tenemos cero y este es lo que sólo vamos a tener que tomar aquí 0 20 3 bien y él sólo 24 entonces aquí nos falta 0 0 [Música] 3 024 y está también y el iraquí nos falta 0 22 y hasta aquí tiene que sumar 0 63 porque los dos suman 1 y esta sería algo que es óptimo y que en realidad aquí empieza a devolverse a las decisiones y prueba a prueba otra forma de asignar y mediante esa esa idea y venidas que empiezan a probar esencialmente todas las posibles combinaciones y da el y bueno aquí le puse una una asignación que era que era posible y cuál es la idea aquí es que este costo es la distancia final la distancia es el costo mínimo posible es probar todas las posibles combinaciones y escoger el mejor plan es el ser mediante siempre el mejor plan nos va a dar la menor distancia desde la distancia termo lo existente es la optimización de la mejor para convertir uno en el otro es decir si hacemos cualquier cambio acá esto último porque seríamos cualquier cambio en el plano entonces la distancia aumentar y la distancia menor posible en mover tiza de una canción es el costo que tenemos que pagar sido así para poder convertir uno en el otro esta es la el mover distantes aquí está la definición nada más numérica es del ejercicio mi mejor acción y entonces dice el input son dos vectores de distribuciones de pesos y una matriz de costos la matriz de costos proviene de las distancias entre c 1 y s n de 1 digo buenos lectores de uno de los vectores de los litoral eso nos permite generar esta matriz de puestos y la de la demo vértice corresponde al costo mismo para convertir uno una institución y los de negocio es decir es en los costos de ese limpio tengo que encontrar una matriz de flujos quien logra con todo mínimo y esa matriz de flujos desde la respuesta y donde los tengo que encontrar los flujos que hay multiplicarlo por el costo correspondiente se minimiza el 4 sujeto a algunas restricciones tristes sujeto a la condición que elegimos a todas formas trimestre posibles razonable la suma por fila tiene que hacer la tiempo responde con la entrada la suma por columna trimestre es la que corresponde a la sal es decir tenemos que cumplir los requerimientos y le imputa a una gris más simples y el output de los looks y eso implica entonces que es la distancia y el a partir de la entrada de los bits de entrada a nuestro calculamos la matriz de costos mediante lo que se llama la gran distancia la gran lista es la que no es una distancia de ayuda aquí es la que nos permite comparar los bienes y qué en principio son la distancia entre colores tiene en el espacio si en el acto no y el laborismo no para representarla fíjate que es nuestra respuesta pues el apu de una matriz la matriz de flujos y el costo y el costo total a pagar para eso martín de flujos en general cuando uno estudia simples simplex unos saben que en peor caso antes y es como estas son malas noticias porque es probar todos contra todos en el peor de los casos uno es decir uno voy a encontrar un input para el que el algoritmo de grid y falle totalmente y que se tome siempre las piedras decisiones y que finalmente tienen que borrar todas las posibles combinaciones esos algoritmos simples pero se dice que en el flipper donde lo definan que que aquí en donde lo aplican para colores que en general es orden de en el cubo lo que me y eso nos motiva aquí en realidad los pictogramas tienen que ser en cortos desde poco pins que en general en el caso pues nosotros vamos estar haciendo un uno mismo especiales por imagen entonces no necesitamos 256 con 5.010 suficiente 10 bien sobre mucho no esta gran vista como estamos dando distancia suscribían a entonces la artista va a cumplir la propiedad américas y que la gran disfraz cumple las rodillas métricas entonces la iron móviles distance cumple las propias metas de eso importante es de encima artistas y una implementación y que los buenos iguales lentas y que se pueden comparar del orden de miles de imágenes en tiempo razonable si con millones de imágenes en realidad demasiado lenta para bienes de imagina de que no hay forma de salirse de la distancia de una situación donde estas cosas para millones de imágenes porque son demasiado devaluación de una variante un poco más rápida de la m-300 una variante variante se llama la asignatura de un paper del bc2010 que esencialmente consiste en producir en esta distancia ante signatures a una forma cuadrática pero un poco un poco más grande porque vamos a generar vectores vamos a concatenar los vectores y vamos tener un espacio de imagen si es que un vector es dimensiones en el otro criterio dimensión m vamos a crear una matriz de similitud y una forma cuadrática pero no tiene imagen y en la máquina similitud más tardado por la la similitud entre la y entran que son hasta aquí en que puede estar para calcular y la similitud inter inter histogramas de haití esta máquina simétricas y que esto es lo que está esencialmente la misma matriz de costos pero esto es una matriz de similitud 23 se evalúa como forma cuadrática respecto de inscriban que los son casos muy presionadas smoke artistas con un costo total de orden d en imagen al cuadrado y eso es parece ser mejor que el de network él no tan notoriamente mejor no no por último es decir que toda esta técnica de ver como actualmente en los histogramas estamos perdiendo en la ubicación espacial cuando recuerdan cuando habrá más histogramas nos decía que existe ahora más de cuatro por cuadro porque son muy buenos con esto era más global va a ser muy malo para buscar imágenes pareciese actualmente lo que hemos visto es que esto es por el histograma de color están estamos perdiendo cómicas tanto subiría agua que es muy fácil que hagamos divisiones de cuatro por cuatro y calculamos tonos de color porciones de hecho es una opción pero ya que si vamos a calcular el signature y la forma de mover tistas entonces podemos hacer algún poco más interesante que hacer en divisiones espaciales rígidas podemos incluirla en el clusterin de corales es decir en una imagen tenemos el color se refiere pero también tenemos la posición xy x y de el pixel y podemos ir a un espacio ahora pero ahora un espacio aquí va a estar difícil de desdibujar r&b txd5 personales y cada pixel va a ser va a estar aquí y esto va a ser una nube de puntos en este espacio de cinco ordenadas vamos tener una nube de puntos cada uno de los píxeles acá va a ser una nube de puntos pero en un espacio de 5 coordenadas y se hace una normalización correcta podemos calcular ser un algoritmo de gaming y de clustering pero de clustering y considerando las 5 coordenadas y vamos a tener entonces los vectores s s 1 s n van a ser la dimensión 5 diciendo el color rgb y la oposición más redundante más represión magma más importante en una imagen y poder todos vamos a tener bien rgv xy para los colores más repetidos y las posiciones más repetidas si hacemos eso vean como después la función distancia es exactamente la misma lágrima clusterin es el mismo solamente que tengo que modificar un poco la prima de casting y podemos calcular histogramas de este estilo como el como el que se represente aquí en más detalle el donde podemos calcular una región y rgb y su posición en y es el mismo el mismo sting mayor y se compara con la misma función del móvil si estás solo que aquí la vemos utilizar la matriz de costos tiene que ponderar en la vejez y elegimos de aquí la gran distancia hay que ser más cuidadoso alguien para comprar adecuadamente los colores con las posiciones en un único número y luego entonces podemos calcular la distancia entre imágenes que sean distancias de colores y sus posiciones entonces vamos a poner de alguna forma esta imagen este blanco en esta arriba va a haber última que quedaría en blanco abajo va a estar más lejos que una imagen en blanco y arriba también esta sería esta composición y entonces ahora esto una gira licencia no tendríamos que hacer direcciones espaciales fijas eso ya no correr porque cualquier parte del cluster y hacemos la división espacial y de colores al mismo tiempo para terminar por último quería comentarles que la artista está implementada en el cáncer pero que la reducción de colores es de clustering y es muy interesante usar la minería y match magic porque ellos tienen ahí unos algoritmos de reducción de colores y la documentación porque el enfoque que toman ellos como saben los colores informativos como se hace la cotización de colores el según y machi mayer y no no hay para quienes -según a implementar el clustering de energía o el plástico de píxeles en en el espacio si el hábito sino que vean como ellos hablan de colores y que uno puede usar los algoritmos de y generar una imagen de menos colores y luego sobre sistema que ya tiene menos colores con los mejores colores representativos podrías hacer el histograma bien defensa de la biblia gracias